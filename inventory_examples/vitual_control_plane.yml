all:
  vars:
    ##################################
    # Assisted Install Configuration #
    ##################################
    cluster_name: vc
    base_dns_domain: example.lab

    # OpenShift version (4.6.16, 4.7.52, 4.8.43, 4.9.40, 4.10.16)
    openshift_full_version: 4.10.16

    # Virtual IPs
    api_vip: 10.60.0.183
    ingress_vip: 10.60.0.184

    vip_dhcp_allocation: false

    machine_network_cidr: 10.60.0.0/24
    service_network_cidr: 172.30.0.0/16
    cluster_network_cidr: 10.128.0.0/14
    cluster_network_host_prefix: 23

    network_type: OVNKubernetes

    ######################################
    # Prerequisite Service Configuration #
    ######################################

    # Flags to disable prerequisite services
    setup_ntp_service: True
    setup_http_store_service: True
    setup_dns_service: True
    setup_registry_service: False
    setup_assisted_installer: True

    # ntp server settings
    ntp_server: 10.40.0.100
    ntp_server_allow: 10.40.0.0/24

    # discovery iso
    discovery_iso_name: "discovery/discovery-image-{{ openshift_full_version }}.iso"
    discovery_iso_server: http://services.example.lab

    ############################
    # Local File Configuration #
    ############################

    repo_root_path: /home/crucible/crucible/ # CHANGE ME

    fetched_dest: "{{ repo_root_path }}/fetched"

    pull_secret_lookup_paths:
      - "{{ fetched_dest }}/pull-secret.txt"
      - "{{ repo_root_path }}/pull-secret.txt"

    ssh_public_key_lookup_paths:
      - "{{ fetched_dest }}/ssh_keys/{{ cluster_name }}.pub"
      - "{{ repo_root_path }}/ssh_public_key.pub"
      - ~/.ssh/id_rsa.pub

    # Set the base directory to store ssh keys
    ssh_key_dest_base_dir: /home/crucible

    # The retrieved cluster kubeconfig will be placed on the bastion host at the following location
    kubeconfig_dest_dir: /home/crucible
    kubeconfig_dest_filename: "{{ cluster_name }}-kubeconfig"

    ############################
    #    LOGIC: DO NOT TOUCH   #
    # vvvvvvvvvvvvvvvvvvvvvvvv #
    ############################

    # pull secret logic, no need to change. Configure above
    local_pull_secret_path: "{{ lookup('first_found', pull_secret_lookup_paths) }}"
    pull_secret: "{{ lookup('file', local_pull_secret_path) }}"

    # ssh key logic, no need to change. Configure above
    local_ssh_public_key_path: "{{ lookup('first_found', ssh_public_key_lookup_paths) }}"
    ssh_public_key: "{{ lookup('file', local_ssh_public_key_path) }}"

    # provided mirror certificate logic, no need to change.
    local_mirror_certificate_path: "{{ (setup_registry_service == true) | ternary(
        fetched_dest + '/' + (hostvars['registry_host']['cert_file_prefix'] | default('registry')) + '.crt',
        repo_root_path + '/mirror_certificate.txt')
      }}"
    mirror_certificate: "{{ lookup('file', local_mirror_certificate_path) }}"

    openshift_version: "{{ openshift_full_version.split('.')[:2] | join('.') }}"

    is_valid_single_node_openshift_config: "{{ (groups['nodes'] | length == 1) and (groups['masters'] | length == 1) }}"

    ############################
    # ^^^^^^^^^^^^^^^^^^^^^^^^ #
    #    LOGIC: DO NOT TOUCH   #
    ############################
  children:
    bastions: # n.b. Currently only a single bastion is supported
      hosts:
        bastion:
          ansible_host: 10.40.0.245
    services:
      vars:
        ansible_host: 10.40.0.100 # All services on the same host
      hosts:
        assisted_installer:
          host: services.example.lab
          port: 8090
        registry_host:
        dns_host:
          upstream_dns: 8.8.8.8
          use_dhcp: true
          dhcp_range_first: 10.60.0.191
          dhcp_range_last: 10.60.0.199
          prefix: 24
          gateway: 10.60.0.1
        http_store:
        ntp_host:
    vm_hosts:
      hosts:
        vm_host1: # Note: there can be more than one
          ansible_host: kvmhost.example.lab
          cert_vars_host_var_key: registry_host
          vm_bridge_interface: ens7f1
          vm_bridge_ip: 10.60.0.190
          dns: "{{ hostvars['dns_host']['ansible_host'] }}"
    nodes:
      vars:
        bmc_user: "{{ VAULT_NODES_BMC_USER | mandatory }}"
        bmc_password: "{{ VAULT_NODES_BMC_PASSWORD | mandatory }}"
      children:
        masters:
          vars:
            role: master
            vendor: KVM
            vm_host: vm_host1 # Name of vm_host
            bmc_address: "{{ hostvars['vm_host1']['ansible_host'] }}:{{ hostvars['vm_host1']['sushy_port'] | default(8082) }}"
            # Optional configure vm spec
            # vm_spec:
            #   ram_mib: 24576
            #   cpu_cores: 8
            #   disk_size_gb: 120
            #   extra_disks:
            #     extra_disk1: 100
          hosts:
            super1:
              ansible_host: 10.60.0.191
              mac: DE:AD:BE:EF:C0:2C
            super2:
              ansible_host: 10.60.0.192
              mac: DE:AD:BE:EF:E2:C5
            super3:
              ansible_host: 10.60.0.193
              mac: DE:AD:BE:EF:84:14
